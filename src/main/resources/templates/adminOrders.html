<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <title>the best hostel in the word</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" th:href="@{/css/normalize.css}"/>
    <link rel="stylesheet" th:href="@{/css/sm-core-css.css.css}"/>
    <link rel="stylesheet" th:href="@{/css/sm-clean.css.css}"/>
    <link rel="stylesheet" th:href="@{/css/main1.css}"/>
    <link rel="stylesheet" th:href="@{/css/skeleton.css}"/>
    <link rel="stylesheet" th:href="@{/css/help.css}"/>
    <script type="text/javascript" th:src="@{/js/jquery-3.5.1.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/jquery.smartmenus.min.js}"></script>

    <script>
      $(document).ready(function() {
          var order1;
          var reserve = {};
          var dates = {};
          $(".confirm").on("click",function(){
               var value1 = $(this).attr('href');
               console.log(value1);
               $("#confirmOrder").show();
               $.getJSON("orders/"+value1,function( order ){
                   console.log(order);
                   reserve.id = order.id;
                   reserve.user = order.user;
                   reserve.room = order.room;
                   reserve.totalPrice = order.totalPrice;
                   reserve.dateIn = order.dateIn;
                   reserve.dateOut = order.dateOut;
                   dates.dateIn = order.dateIn;
                   dates.dateOut = order.dateOut;
                   dates.roomId = order.room.id;
                   dates.orderId = order.id;
                   console.log(dates.dateIn);
                   console.log(dates.dateOut);
                   console.log(dates.roomId);
                   result_json = JSON.stringify(reserve);
                   console.log(result_json);
                   $.post("reserves/isFree",dates,function(data){
                      console.log(data);
                      if(data == "notFree"){
                         $("#message1").show();
                      }else{
                         $("#message").show();
                         $("#res").show();
                         $("#res").text(data);
                      }
                   });

               });
             return false;
          });

          $("#cancelCO").click(function() {
            $("#confirmOrder").hide();
            $("#message1").hide();
            $("#message").hide();
            $("#res").hide();
            return false;
          });


           $("#confirmOrder1").click(function() {
                      $("#message1").hide();
                      $("#message").hide();
                      $("#res").hide();
                      result_json = JSON.stringify(reserve);
                           $.ajax({
                              type: 'POST',
                              url: 'reserves',
                              contentType: 'application/json',
                              data: result_json,
                              success: function(data) {
                                   console.log("done");
                                   document.location.href = "reserves";
                              },
                              error:  function(){
                                 alert('Ошибка!');
                              }
                           });
                      return false;
           });


          $(".deleteR").on("click", function() {
                 var value1 = $(this).attr('href');
                 console.log(value1);
                 $("#delete").show();
                 url1 = value1;
                 console.log("url = "+url1);
                 return false;
          });

          $("#deleteForm").click(function(event) {
                 event.preventDefault();
                 var req = new XMLHttpRequest();
                 req.open("DELETE", "orders/" + url1, false);
                 req.send(null);
                 document.location.href = "orders";
          });
          $("#cancelD").click(function() {
                  $("#delete").hide();
                  return false;
          });
      });
     </script>
</head>


<body>
    <header>
        <div class="container">
            <div class="row">
                <div class="three columns">
                    <a href="home.html">
                        <img th:src="@{/images/img/hotel_1_1.png}" class="logo"/>
                    </a>
                    <p class="text">.com</p>
                </div>



                <div class="nine columns">
                    <nav class="nav">
                        <div sec:authorize="!isAuthenticated()">
                            <a href="loginForm">log In</a>
                        </div>
                        <div sec:authorize="isAuthenticated()">
                            <!-- <form method="POST" th:action="@{/logout}">
                                 <input type="submit" value="Logout"/>
                             </form>-->
                            <a th:href="@{/logout}" >log Out</a>
                        </div>
                        <div sec:authorize="!isAuthenticated()">
                            <a href="registration">registratinion</a>
                        </div>
                        <div sec:authorize="isAuthenticated()">
                            <a href="profile">cabinet</a>
                        </div>


                        <a href="#">About Us</a>
                        <a class="current-page" href="../rooms">rooms</a>
                        <a href="../">Home</a>
                    </nav>
                </div>
            </div>

        </div>
    </header>
    <div class="container">
        <div class="row rooms">
            <div class="four columns">
                Client
            </div>
            <div class="seven columns">
                Room
            </div>
            <div class="two columns">
                total price
            </div>
        </div>
           <!-- <c:if test="${ not empty datesNotFreeError}">
			<p><fmt:message key="${message}" bundle="${rs}" /></p>
			</c:if>-->

        <div th:each="order : ${orders}">
        <div class="row rowdata">
            <div class="four columns data">
                <div class="profile">

                </div>
                <div>
                    <p> Name : <span th:text="${order.user.name}"/></p>
                    <p>Surname : <span th:text="${order.user.surname}"/></p>
                    <p>Email : <span th:text="${order.user.email}"/></p>
                </div>
            </div>
            <div class="seven columns data ">
                <div class=" imgd">
                    <img class="img" th:src="@{/images/img1/1.jpg}" width="250" height="150"/>
                </div>
                <div>
                    <p class="price">Number : <span th:text="${order.room.number}"/></p>
                    <p class="sits">Arrive date : <span th:text="${order.dateIn}"/></p>
                    <p>Leave date : <span th:text="${order.dateOut}"/></p>
                </div>
            </div>
            <div class="two columns data ">
                <div>
                    <p> <span th:text="${order.totalPrice}"/></p>
                </div>
                <p class="more"><a class="deleteR" th:href="@{{id}(id=${order.id})}">Cancel</a></p>
                <p class="more more1"><a class="confirm" th:href="@{{id}(id=${order.id})}">Confirm</a></p>
            </div>
        </div>
        </div>
    </div>

     <div class=" container chooseDateDialog1" id="delete" title="Chose dates" hidden>
           <div id="hide" class="row">
                <p>This dioloq window.You can moove it in the window</p>
                       delete this reserve?
                       <div>
                          <a id="cancelD" class="previous" href="#">Previous</a>
                          <a id="deleteForm" class="makeorder" href="75" >Delete</a>
                       </div>
           </div>
     </div>

     <div class=" container chooseDateDialog1" id="confirmOrder" title="Chose dates" hidden>
                <div id="hide1" class="row">
                                    <p id="message" hidden>It will be cost for user
                                    <p id="res" class="desc1" hidden> </p>
                                    </p>
                                    <p id="message1" hidden>not free
                                    </p>
                            <div>
                               <a id="cancelCO" class="previous" href="#">Previous</a>
                               <a id="confirmOrder1" class="makeorder" href="75" >Confirm</a>
                            </div>
                </div>
     </div>


    <footer>
        <div class="container ">
            <div class="row ">
                <div class="twelve columns ">
                    <p id="text ">Foot</p>
                </div>
            </div>
        </div>
    </footer>

</body>

</html>